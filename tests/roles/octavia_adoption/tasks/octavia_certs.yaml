- name: Migrate old Octavia certificates to new dual CA structure
  ansible.builtin.shell: |
    {{ shell_header }}
    {{ oc_header }}
    CONTROLLER1_SSH="{{ controller1_ssh }}"
    SERVER_CA_PASSPHRASE=$($CONTROLLER1_SSH grep ^ca_private_key_passphrase /var/lib/config-data/puppet-generated/octavia/etc/octavia/octavia.conf)

    oc apply -f - <<EOF
    apiVersion: v1
    kind: Secret
    metadata:
      name: octavia-ca-passphrase
    type: Opaque
    data:
      server-ca-passphrase: $(echo -n $SERVER_CA_PASSPHRASE | base64 -w0)
    EOF
