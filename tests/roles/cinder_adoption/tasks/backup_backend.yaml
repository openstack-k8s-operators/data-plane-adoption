- name: deploy podified Cinder backup
  when: cinder_backup_backend == 'ceph'
  ansible.builtin.shell: |
    {{ shell_header }}
    {{ oc_header }}
    oc patch openstackcontrolplane openstack --type=merge --patch '{{ cinder_backup_ceph_patch }}'

- name: deploy podified Cinder backup
  when: cinder_backup_backend == 'swift'
  ansible.builtin.shell: |
    {{ shell_header }}
    {{ oc_header }}
    oc patch openstackcontrolplane openstack --type=merge --patch '{{ cinder_backup_swift_patch }}'

# the 'ontap-nfs' choice is kept for compatibility reason, at least for a while
- name: deploy podified Cinder volume with NFS
  when: >
    cinder_backup_backend == 'nfs' or
    cinder_backup_backend == 'ontap-nfs'
  ansible.builtin.include_tasks: cinder_backup_nfs.yaml

- name: Apply additional cinder-backup settings
  ansible.builtin.include_tasks: extra_cinder_backup_settings.yaml
  when: cinder_backup_nodeselector | length > 0
