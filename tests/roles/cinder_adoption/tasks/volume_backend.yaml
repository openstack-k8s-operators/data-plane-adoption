- name: deploy podified Cinder volume
  when:
    - cinder_volume_backend == 'ceph'
    - cinder_dcn_clusters | length == 0
  ansible.builtin.shell: |
    {{ shell_header }}
    {{ oc_header }}
    oc patch openstackcontrolplane openstack --type=merge --patch '{{ cinder_volume_backend_patch }}'

- name: deploy podified Cinder volume with Ceph multi-backend configuration for DCN
  when:
    - cinder_volume_backend == 'ceph'
    - cinder_dcn_clusters | length > 0
  ansible.builtin.include_tasks: cinder_volume_dcn.yaml

- name: deploy podified Cinder volume with netapp NFS or iSCSI
  when: >
    cinder_volume_backend == 'ontap-nfs' or
    cinder_volume_backend == 'ontap-iscsi'
  ansible.builtin.include_tasks: cinder_volume_netapp.yaml

- name: deploy podified Cinder volume with pure FC
  when: >
    cinder_volume_backend == 'pure-fc'
  ansible.builtin.include_tasks: cinder_volume_pure.yaml

- name: Apply additional settings to Cinder volumes
  ansible.builtin.include_tasks: extra_cinder_volumes_settings.yaml
  when: cinder_volumes_nodeselector | length > 0
