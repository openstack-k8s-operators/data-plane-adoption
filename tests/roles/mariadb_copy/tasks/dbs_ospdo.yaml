#The following setup and execute the db extarction
- name: set mariadb_copy_tmp_dir var
  set_fact:
    mariadb_copy_tmp_dir: /tmp/mariadb

- name: run get dbs script on galera container
  delegate_to: "{{ adoption_ospdo_host }}"
  ansible.builtin.shell: |

      {{ controller1_ssh }} {{ dpa_templates }}/dump_dbs.bash

# Copy DB dumps to local tmp
- name: Copy DB dumps ctrl0 to openstackclient
  delegate_to: "{{ adoption_ospdo_host }}"
  ansible.builtin.shell: |
      {{ exec_ospdoclnt_pod }} -- bash -c "rsync -a controller-0.ctlplane:/tmp/mariadb /tmp"

- name: Copy DB dumps openstackclient to BM
  delegate_to: "{{ adoption_ospdo_host }}"
  ansible.builtin.shell: |
     oc cp openstack/openstackclient:/tmp/mariadb/ /tmp/mariadb

- name: Copy DB dumps BM to local
  ansible.builtin.shell: |
      scp -r root@{{ adoption_ospdo_host }}:/tmp/mariadb /tmp

- name: Show DB dumps on local
  ansible.builtin.shell: |
      ls /tmp/mariadb/
