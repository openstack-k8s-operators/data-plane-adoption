---
undercloud:
  config:
    - section: DEFAULT
      option: undercloud_hostname
      value: undercloud.example.com
    - section: DEFAULT
      option: undercloud_timezone
      value: UTC
    - section: DEFAULT
      option: undercloud_debug
      value: true
    - section: DEFAULT
      option: container_cli
      value: podman
    - section: DEFAULT
      option: undercloud_enable_selinux
      value: false
    - section: DEFAULT
      option: generate_service_certificate
      value: false
    - section: DEFAULT
      option: ipv6_address_mode
      value: dhcpv6-stateful
    - section: DEFAULT
      option: enable_routed_networks
      value: true

  undercloud_parameters_override: "uni04delta-ipv6/hieradata_overrides_undercloud.yaml"
  undercloud_parameters_defaults: "uni04delta-ipv6/undercloud_parameter_defaults.yaml"
  ctlplane_vip: 2620:cf:cf:aaaa::98

cloud_domain: "example.com"
hostname_groups_map:
  # map ansible groups in the inventory to role hostname format for
  # 17.1 deployment
  osp-computes: "overcloud-compute"
  osp-controllers: "overcloud-controller"
roles_groups_map:
  # map ansible groups to tripleo Role names
  osp-computes: "Compute"
  osp-controllers: "Controller"
stacks:
  - stackname: "overcloud"
    args:
      - "--override-ansible-cfg /home/zuul/ansible_config.cfg"
      - "--templates /usr/share/openstack-tripleo-heat-templates"
      - "--libvirt-type qemu"
      - "--timeout 90"
      - "--overcloud-ssh-user zuul"
      - "--deployed-server"
      - "--validation-warnings-fatal"
      - "--disable-validations"
      - "--heat-type pod"
      - "--disable-protected-resource-types"
    vars:
      - "/usr/share/openstack-tripleo-heat-templates/environments/docker-ha.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/podman.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/low-memory-usage.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/debug.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/enable-legacy-telemetry.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/services/barbican.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/barbican-backend-simple-crypto.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/external-ceph.yaml"
      - "/usr/share/openstack-tripleo-heat-templates/environments/manila-cephfsganesha-config.yaml"
      - "/home/zuul/external_ceph_params.yaml"
    network_data_file: "uni04delta-ipv6/network_data.yaml.j2"
    vips_data_file: "uni04delta-ipv6/vips_data.yaml"
    roles_file: "uni04delta-ipv6/roles.yaml"
    config_download_file: "uni04delta-ipv6/config_download.yaml"
    stack_nodes:
      - osp-computes
      - osp-controllers
    pre_oc_run:
      - name: 01 Prepare Ceph nodes
        type: playbook
        source: "setup_cephnodes_ipv6.yaml"
        inventory: "{{ ansible_user_dir }}/{{ zuul.projects['github.com/openstack-k8s-operators/data-plane-adoption'].
                    src_dir }}/scenarios/uni04delta-ipv6/ceph_inventory.yaml"
      - name: 02 Deploy external ceph
        type: playbook
        source: "ceph.yml"
        gathering: implicit
        inventory: "{{ ansible_user_dir }}/{{ zuul.projects['github.com/openstack-k8s-operators/data-plane-adoption'].
                    src_dir }}/scenarios/uni04delta-ipv6/ceph_inventory.yaml"
      - name: 03 Create external Ceph parameters file
        type: playbook
        source: "create_external_ceph_params.yml"
        extra_vars:
          ceph_node: "osp-ext-ceph-uni04delta-ipv6-0"
          ceph_mon_host: "2620:cf:cf:cccc::6a,2620:cf:cf:cccc::6b,2620:cf:cf:cccc::6c"
    post_oc_run:
      - name: Ironic post overcloud deploy
        type: playbook
        source: adoption_ironic_post_oc.yml
        extra_vars:
          _subnet_ip_version: 6
          _subnet_ipv6_address_mode: dhcpv6-stateful
          _subnet_ipv6_ra_mode: dhcpv6-stateful
          _subnet_range: 2620:cf:cf:ffff::0/64
          _subnet_gateway: 2620:cf:cf:ffff::1
          _subnet_alloc_pool_start: 2620:cf:cf:ffff::300
          _subnet_alloc_pool_end: 2620:cf:cf:ffff::399
